<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kuis Interaktif - Sektor Jasa Keuangan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        .question-nav-item {
            transition: all 0.2s ease-in-out;
        }
        .question-nav-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .option-item {
            transition: all 0.2s ease-in-out;
            cursor: pointer;
        }
        .option-item:hover {
            background-color: #f1f5f9;
            border-color: #3b82f6;
        }
        .explanation-card {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-out, padding 0.5s ease-out, background-color 0.5s ease-out;
        }
        .explanation-card.show {
            max-height: 500px;
            padding: 1rem;
        }
    </style>
</head>
<body class="text-gray-800">

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-800">Kuis Interaktif</h1>
            <p class="text-slate-600 mt-2">Uji Pengetahuan Anda di Sektor Jasa Keuangan</p>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-1 bg-white p-6 rounded-xl shadow-lg h-fit sticky top-8">
                <h2 class="text-xl font-bold mb-4">Navigasi Soal</h2>
                <div class="mb-4">
                    <label for="category-filter" class="block text-sm font-medium text-gray-700 mb-2">Filter Kategori:</label>
                    <select id="category-filter" class="w-full bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5">
                        <option value="all">Semua Kategori</option>
                    </select>
                </div>
                <div id="question-navigation" class="max-h-[500px] overflow-y-auto pr-2"></div>
                <button id="show-results-btn" class="w-full mt-6 bg-green-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-600 transition duration-300">
                    Lihat Hasil Akhir
                </button>
            </div>

            <div id="quiz-container" class="lg:col-span-2 bg-white p-6 md:p-8 rounded-xl shadow-lg">
                <div id="welcome-screen" class="text-center">
                    <h2 class="text-2xl font-bold text-slate-800 mb-4">Selamat Datang!</h2>
                    <p class="text-slate-600 mb-6">Silakan pilih nomor soal dari panel navigasi di sebelah kiri untuk memulai kuis. Anda dapat mengerjakan soal secara acak.</p>
                    <p class="text-sm text-slate-500">Hasil jawaban (benar/salah) akan langsung terlihat setelah Anda menjawab.</p>
                </div>
                <div id="question-display" class="hidden">
                    <div class="flex justify-between items-start mb-4">
                         <p id="question-category" class="bg-blue-100 text-blue-800 text-sm font-semibold mr-2 px-3 py-1 rounded-full"></p>
                         <p class="text-lg font-semibold text-slate-700">Soal #<span id="question-number"></span></p>
                    </div>
                    <p id="question-text" class="text-lg text-gray-800 leading-relaxed mb-6"></p>
                    <div id="options-container" class="space-y-3"></div>
                    <div id="explanation-container" class="mt-6"></div>
                     <div class="mt-8 flex justify-end">
                        <button id="next-question-btn" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 transition duration-300 hidden">
                            Soal Berikutnya &rarr;
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div id="results-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex justify-center items-center">
        <div class="bg-white rounded-lg shadow-xl p-8 m-4 max-w-2xl w-full">
            <h2 class="text-2xl font-bold mb-4 text-center">Hasil Kuis Anda</h2>
            <div class="flex justify-around text-center mb-6">
                <div><p class="text-lg font-semibold">Skor Akhir</p><p id="final-score" class="text-4xl font-bold text-blue-600">0%</p></div>
                <div><p class="text-lg font-semibold">Jawaban Benar</p><p id="correct-answers" class="text-4xl font-bold text-green-600">0</p></div>
                <div><p class="text-lg font-semibold">Jawaban Salah</p><p id="incorrect-answers" class="text-4xl font-bold text-red-600">0</p></div>
            </div>
            <h3 class="text-xl font-bold mb-3 text-center">Analisis Berdasarkan Kategori</h3>
            <div id="category-results" class="space-y-3"></div>
            <div class="mt-6 text-center"><button id="close-modal-btn" class="bg-gray-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-600 transition duration-300">Tutup</button></div>
        </div>
    </div>

    <script src="database.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            let userAnswers = {};
            let currentQuestionId = null;
            const questionNavigation = document.getElementById('question-navigation');
            const questionDisplay = document.getElementById('question-display');
            const welcomeScreen = document.getElementById('welcome-screen');
            const categoryFilter = document.getElementById('category-filter');
            const resultsModal = document.getElementById('results-modal');
            const showResultsBtn = document.getElementById('show-results-btn');
            const closeModalBtn = document.getElementById('close-modal-btn');

            function initializeQuiz() {
                if (typeof questions === 'undefined') {
                    console.error("Database soal (questions) tidak ditemukan. Pastikan file database.js sudah termuat dengan benar.");
                    welcomeScreen.innerHTML = `<h2 class="text-2xl font-bold text-red-500 mb-4">Error!</h2><p class="text-red-600">Gagal memuat database soal. Silakan periksa file database.js dan coba lagi.</p>`;
                    return;
                }
                const categories = [...new Set(questions.map(q => q.category))];
                categories.sort().forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    categoryFilter.appendChild(option);
                });
                renderNavigation();
                categoryFilter.addEventListener('change', renderNavigation);
                showResultsBtn.addEventListener('click', showResults);
                closeModalBtn.addEventListener('click', () => resultsModal.classList.add('hidden'));
            }

            function renderNavigation() {
                questionNavigation.innerHTML = '';
                const selectedCategory = categoryFilter.value;
                const filteredQuestions = questions.filter(q => selectedCategory === 'all' || q.category === selectedCategory);
                for (let groupStart = 1; groupStart <= 200; groupStart += 25) {
                    const groupEnd = groupStart + 24;
                    const groupHeader = document.createElement('h4');
                    groupHeader.textContent = `Soal ${groupStart} - ${groupEnd}`;
                    groupHeader.className = 'text-sm font-semibold text-gray-500 mt-4 pb-1 border-b';
                    if (groupStart === 1) { groupHeader.classList.remove('mt-4'); }
                    const gridContainer = document.createElement('div');
                    gridContainer.className = 'grid grid-cols-5 sm:grid-cols-6 md:grid-cols-7 lg:grid-cols-5 gap-2 pt-2';
                    let groupHasVisibleQuestions = false;
                    for (let i = groupStart; i <= groupEnd; i++) {
                        const questionData = questions.find(q => q.id === i);
                        const isVisible = selectedCategory === 'all' || (questionData && questionData.category === selectedCategory);
                        if (isVisible && questionData) {
                            groupHasVisibleQuestions = true;
                            const navItem = document.createElement('div');
                            navItem.textContent = i;
                            navItem.className = 'w-10 h-10 flex items-center justify-center font-bold rounded-md shadow-sm question-nav-item cursor-pointer';
                            if (userAnswers[i]) {
                                navItem.classList.add(userAnswers[i].isCorrect ? 'bg-green-500' : 'bg-red-500', 'text-white', 'border-transparent');
                            } else {
                                navItem.classList.add('bg-white', 'border', 'border-gray-300', 'text-gray-700');
                            }
                            if (i === currentQuestionId) { navItem.classList.add('ring-2', 'ring-blue-500', 'ring-offset-2'); }
                            navItem.addEventListener('click', () => displayQuestion(i));
                            gridContainer.appendChild(navItem);
                        }
                    }
                    if (groupHasVisibleQuestions) {
                        questionNavigation.appendChild(groupHeader);
                        questionNavigation.appendChild(gridContainer);
                    }
                }
            }

            function displayQuestion(id) {
                currentQuestionId = id;
                const question = questions.find(q => q.id === id);
                if (!question) return;
                welcomeScreen.classList.add('hidden');
                questionDisplay.classList.remove('hidden');
                document.getElementById('question-number').textContent = question.id;
                document.getElementById('question-category').textContent = question.category;
                document.getElementById('question-text').textContent = question.question;
                const optionsContainer = document.getElementById('options-container');
                optionsContainer.innerHTML = '';
                const filteredQuestions = questions.filter(q => categoryFilter.value === 'all' || q.category === categoryFilter.value);
                const shuffledOptions = [...question.options].sort(() => Math.random() - 0.5);
                shuffledOptions.forEach(option => {
                    const optionWrapper = document.createElement('div');
                    optionWrapper.classList.add('option-item', 'border', 'border-gray-300', 'p-4', 'rounded-lg', 'text-gray-700', 'font-medium');
                    optionWrapper.dataset.option = option;
                    optionWrapper.innerHTML = `<span>${option}</span>`;
                    optionWrapper.addEventListener('click', () => handleOptionSelect(question, option));
                    optionsContainer.appendChild(optionWrapper);
                });
                document.getElementById('explanation-container').innerHTML = '';
                const nextBtn = document.getElementById('next-question-btn');
                nextBtn.classList.add('hidden');
                nextBtn.onclick = () => {
                    const currentIndex = filteredQuestions.findIndex(q => q.id === currentQuestionId);
                    if (currentIndex !== -1 && currentIndex < filteredQuestions.length - 1) {
                        displayQuestion(filteredQuestions[currentIndex + 1].id);
                    }
                };
                if (userAnswers[id]) { showAnswer(question, userAnswers[id].selected); }
                renderNavigation();
            }

            function handleOptionSelect(question, selectedOption) {
                if (userAnswers[question.id]) return;
                const isCorrect = selectedOption === question.answer;
                userAnswers[question.id] = { selected: selectedOption, isCorrect: isCorrect };
                showAnswer(question, selectedOption);
                renderNavigation();
            }

            function showAnswer(question, selectedOption) {
                const isCorrect = userAnswers[question.id].isCorrect;
                const options = document.querySelectorAll('.option-item');
                options.forEach(opt => {
                    opt.style.pointerEvents = 'none';
                    const optionText = opt.dataset.option;
                    if (optionText === question.answer) {
                        opt.classList.remove('border-gray-300');
                        opt.classList.add('bg-green-50', 'border-green-500', 'text-green-800', 'font-bold');
                        opt.innerHTML += `<span class="ml-auto text-green-600 font-bold">&#10003;</span>`;
                    } else if (optionText === selectedOption) {
                        opt.classList.remove('border-gray-300');
                        opt.classList.add('bg-red-50', 'border-red-500', 'text-red-800');
                        opt.innerHTML += `<span class="ml-auto text-red-600 font-bold">&#10007;</span>`;
                    }
                    opt.classList.add('flex', 'items-center');
                });
                const explanationContainer = document.getElementById('explanation-container');
                explanationContainer.innerHTML = '';
                const explanationCard = document.createElement('div');
                explanationCard.className = 'explanation-card border-l-4 rounded-r-lg';
                const title = document.createElement('h4');
                title.className = 'font-bold';
                title.textContent = 'Pembahasan:';
                const text = document.createElement('p');
                text.className = 'mt-2';
                text.textContent = question.explanation;
                if (isCorrect) {
                    explanationCard.classList.add('bg-green-50', 'border-green-500');
                    title.classList.add('text-green-800');
                    text.classList.add('text-green-700');
                } else {
                    explanationCard.classList.add('bg-red-50', 'border-red-500');
                    title.classList.add('text-red-800');
                    text.classList.add('text-red-700');
                }
                explanationCard.appendChild(title);
                explanationCard.appendChild(text);
                explanationContainer.appendChild(explanationCard);
                setTimeout(() => explanationCard.classList.add('show'), 10);
                const filteredQuestions = questions.filter(q => categoryFilter.value === 'all' || q.category === categoryFilter.value);
                const currentIndex = filteredQuestions.findIndex(q => q.id === currentQuestionId);
                if (currentIndex < filteredQuestions.length - 1) {
                    document.getElementById('next-question-btn').classList.remove('hidden');
                }
            }

            function showResults() {
                const totalAnswered = Object.keys(userAnswers).length;
                if (totalAnswered === 0) {
                    alert("Anda belum menjawab satu soal pun.");
                    return;
                }
                const correctCount = Object.values(userAnswers).filter(ans => ans.isCorrect).length;
                const incorrectCount = totalAnswered - correctCount;
                const score = (correctCount / questions.length) * 100;
                document.getElementById('final-score').textContent = `${score.toFixed(0)}%`;
                document.getElementById('correct-answers').textContent = correctCount;
                document.getElementById('incorrect-answers').textContent = incorrectCount;
                const categoryResultsContainer = document.getElementById('category-results');
                categoryResultsContainer.innerHTML = '';
                const categories = [...new Set(questions.map(q => q.category))];
                categories.forEach(category => {
                    const answeredInCategory = Object.keys(userAnswers).filter(id => {
                        const q = questions.find(q => q.id == id);
                        return q && q.category === category;
                    });
                    const correctInCategory = answeredInCategory.filter(id => userAnswers[id].isCorrect).length;
                    if (answeredInCategory.length > 0) {
                        const categoryScore = (correctInCategory / answeredInCategory.length) * 100;
                        const resultEl = document.createElement('div');
                        resultEl.innerHTML = `
                            <div class="flex justify-between items-center mb-1">
                                <span class="font-semibold text-gray-700">${category}</span>
                                <span class="text-sm text-gray-500">${correctInCategory}/${answeredInCategory.length} benar</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2.5">
                                <div class="h-2.5 rounded-full ${categoryScore > 60 ? 'bg-green-500' : 'bg-red-500'}" style="width: ${categoryScore}%"></div>
                            </div>
                        `;
                        categoryResultsContainer.appendChild(resultEl);
                    }
                });
                resultsModal.classList.remove('hidden');
            }
            initializeQuiz();
        });
    </script>
</body>
</html>
